<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="estilo.css">
    <link rel="shortcut icon" href="favicon/favicon.ico" type="image/x-icon">
    <title>Dados Técnicos</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>

</head>
<body>
    <header>
        <h1>Cálculo de peça e conjunto</h1>
        <h3>* Preencha todos os campos solicitados *</h3>
    </header>

    <section>
        <div id="caesa">
            <label for="peca: "><strong>Nome da peça Caesa:</strong> </label>
            <input type="text" name="peca" id="peca" oninput="this.value = this.value.toUpperCase()" required>
            <label for="qtde"><strong>Quantidade:</strong></label>
            <input type="number" name="qtde" id="qtde" required>

            <!-- O evento oninput acima, converte tudo que for digitado na caixa de texto, para letras maiúsculas -->
            <!-- this.value refere-se ao valor atual do texto digitado -->

        </div>
        <div id="principal">
            <h3>Características Técnicas</h3>
            <p id="mater">
                <input type="radio" name="radmat" id="aco" value="8"> <!-- valor 0 -->
                <label for="aco">Aço Carbono</label>
                <input type="radio" name="radmat" id="alum" value="2.7"> <!-- valor 1 -->
                <label for="alum">Alumínio</label>
                <input type="radio" name="radmat" id="galv" value="8.1"> <!-- valor 2 -->
                <label for="galv">Gavanizado</label>
                <input type="radio" name="radmat" id="inox" value="8.2"> <!-- valor 3 -->
                <label for="inox">Inox</label>
            </p>
            <p>Comprimento (mm):
                <input type="number" name="num1" id="num1" required>
            </p>
            <p>Largura (mm):
                <input type="number" name="num2" id="num2" required>
            </p>
            <p>Espessura (mm):
                <input type="number" name="num3" id="num3" required>
            </p>
            <p>
                <input type="button" value="Calcular" id="bt1" onclick="verificarDados()">
                <input type="button" value="Limpar Dados" id="bt2" onclick="limpar()">
                <input type="button" value="Exportar PDF" id="btExportar" onclick="exportarPDF()">
            </p>
        </div>

        <div id="resultAnt">
            <h3>Estrutura Solpen</h3>
            <h4>Cálculo do Conjunto</h4>
            <ul id="lista-resultados"></ul>
            <p id="soma-metroQuad"><strong>Metro² Total:</strong></p>            
            <p id="soma-peso"><strong>Peso Total: </strong></p>
            <p id="soma-tinta"><strong>Tinta Total: </strong></p>
        </div>

        <div id="limpar">

        </div>
    </section>

    <footer>
        <p>&copy; By Leandro Lopes</p>
    </footer>

    <script>
        // Variáveis globais
        var peca = document.getElementById('peca');
        var qtde = document.getElementById('qtde');       
        var num1 = document.getElementById('num1');
        var num2 = document.getElementById('num2');
        var num3 = document.getElementById('num3');
        var botaoCalcular = document.getElementById('bt1');
        var botaoLimpar = document.getElementById('bt2');
        var botaoExportarPDF = document.getElementById('btExportar');
        var listaResultados = document.getElementById('lista-resultados');
        var somaTinta = document.getElementById('soma-tinta');
        var somaPeso = document.getElementById('soma-peso');
        var somaMetroQuad = document.getElementById('soma-metroQuad');
        var material = document.getElementsByName('radmat');
        var totalMetroQuad = 0;
        var totalPeso = 0;
        var totalTinta = 0;

        botaoLimpar.disabled = true;
        botaoExportarPDF.disabled = true;
        
        function verificarDados() {

            if (peca.value.trim() === "" || num1.value.trim() === "" || num2.value.trim() === "" || num3.value.trim() === "" || qtde.value.trim() === "") {
                alert("Digite valores válidos!");
            } else {
                calcular();
            }            
        }

        /*
        function verificarMaterial() {

            if (material[0].checked) {
                densidade = 8
                calcular()
            } else if (material[1].checked) {
                densidade = 2.7
                calcular()
            } else if (material[2].checked) {
                densidade = 8.1
                calcular()
            } else if (material[3].checked) {
                densidade = 8.2
                calcular()
            } else {
                alert("Escolha o material!")
            }
        }
        */

        function calcular() {

            var textoPeca = peca.value;
            var quantidade = Number(qtde.value);
            var val1 = Number(num1.value);
            var val2 = Number(num2.value);
            var val3 = Number(num3.value);
            var densidade = parseFloat(document.querySelector('input[name="radmat"]:checked').value); // Obtém a densidade diretamente do radio button
            var metroQuad = (val1/1000) * (val2/1000);
            var peso = metroQuad * val3 * densidade;
            var tinta = (metroQuad * 2) / 3.6;

            // Lista que armazena os resultados anteriores
            var itemResultado = document.createElement('li')
            itemResultado.innerHTML = `<strong>PEÇA:</strong> ${textoPeca} <strong>Quantidade:</strong> ${quantidade}x <br> * Valores por unidade --> <strong>Metro²:</strong> ${metroQuad.toFixed(3)} m² | <strong>Peso:</strong> ${peso.toFixed(3)} Kg | <strong>Tinta:</strong> ${tinta.toFixed(3)} Kg`;
            listaResultados.appendChild(itemResultado);
            
            // Atualizar as somas totais
            totalMetroQuad += (metroQuad * quantidade);
            totalPeso += (peso * quantidade);
            totalTinta += (tinta * quantidade);

            somaMetroQuad.innerHTML = `Metro² Total: ${totalMetroQuad.toFixed(3)} M²`;
            somaPeso.innerHTML = `Peso Total: ${totalPeso.toFixed(3)} Kg`;
            somaTinta.innerHTML = `Tinta Total: ${totalTinta.toFixed(3)} Kg`;

            desabilitarCampos();
        }

        function desabilitarCampos() {

            peca.disabled = true;
            qtde.disabled = true;
            num1.disabled = true;
            num2.disabled = true;
            num3.disabled = true;
            botaoCalcular.disabled = true;           
            botaoLimpar.disabled = false;
            botaoExportarPDF.disabled = false;
            
        }

        function limpar() {

            peca.disabled = false;
            qtde.disabled = false;
            num1.disabled = false;
            num2.disabled = false;
            num3.disabled = false;
            botaoCalcular.disabled = false;
            peca.value = "";
            qtde.value = "";
            num1.value = "";
            num2.value = "";
            num3.value = "";

            botaoLimpar.disabled = true;
            botaoExportarPDF.disabled = true;

            peca.focus();

        }

        function exportarPDF() {
            const { jsPDF } = window.jspdf;
            let doc = new jsPDF();
            let texto = `Peça: ${peca.value}\nQuantidade: ${qtde.value}\nMetro² Total: ${totalMetroQuad.toFixed(3)} m²\nPeso Total: ${totalPeso.toFixed(3)} Kg\nTinta Total: ${totalTinta.toFixed(3)} Kg`;

            doc.text(texto, 10, 10);

            // Formata o conteúdo da lista como texto
            let listaResultadosTexto = "";
            for (let i = 0; i < listaResultados.children.length; i++) {
                listaResultadosTexto += listaResultados.children[i].innerText + "\n";
            }

            doc.text(listaResultadosTexto, 10, 30);

            doc.save('dados_tecnicos.pdf');
        }

    </script>
</body>
</html>